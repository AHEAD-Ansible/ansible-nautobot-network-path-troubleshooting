---
# Lookup Nautobot interface objects.
# Provide interface filters explicitly; optional device name and interface name helpers.

- name: Build interface lookup filters
  vars:
    _filters: []
  ansible.builtin.set_fact:
    nautobot_lookup__interface_filters: "{{ _filters }}"

- name: Add device helper filter
  ansible.builtin.set_fact:
    nautobot_lookup__interface_filters: "{{ nautobot_lookup__interface_filters + ['device=' ~ nautobot_lookup_interface_device] }}"
  when: nautobot_lookup_interface_device is defined and nautobot_lookup_interface_device | length > 0

- name: Add name helper filter
  ansible.builtin.set_fact:
    nautobot_lookup__interface_filters: "{{ nautobot_lookup__interface_filters + ['name=' ~ nautobot_lookup_interface_name] }}"
  when: nautobot_lookup_interface_name is defined and nautobot_lookup_interface_name | length > 0

- name: Merge explicit interface filters
  vars:
    _extra: >-
      {{
        nautobot_lookup_interface_filters
        if (nautobot_lookup_interface_filters is defined)
        else []
      }}
  ansible.builtin.set_fact:
    nautobot_lookup__interface_filters: >-
      {{
        nautobot_lookup__interface_filters
        + (_extra if (_extra is iterable and not (_extra is string)) else ([_extra] if (_extra is string and (_extra | length) > 0) else []))
      }}

- name: Ensure interface filters present
  ansible.builtin.assert:
    that:
      - nautobot_lookup__interface_filters | length > 0
    fail_msg: "Provide at least one filter for Nautobot interface lookups."

- name: Run Nautobot interface lookup
  ansible.builtin.include_tasks: _run_lookup.yml
  vars:
    nautobot_lookup_resource: "{{ nautobot_lookup_interface_resource | default('interfaces') }}"
    nautobot_lookup_filters: "{{ nautobot_lookup__interface_filters }}"
    nautobot_lookup_depth_value: >-
      {{
        nautobot_lookup_depth
        if (nautobot_lookup_depth is defined)
        else (nautobot_lookup_default_depth if (nautobot_lookup_default_depth is defined) else none)
      }}

- name: Cleanup helper fact
  ansible.builtin.set_fact:
    nautobot_lookup__interface_filters: []
