---
# Lookup Nautobot platform objects.
# Accepts platform ID, slug, or filters via helper variables.

- name: Validate platform lookup inputs
  ansible.builtin.assert:
    that:
      - (
          nautobot_lookup_platform_id is defined and nautobot_lookup_platform_id | length > 0
        )
        or (
          nautobot_lookup_platform_filters is defined
          and (nautobot_lookup_platform_filters | length) > 0
        )
    fail_msg: "Provide nautobot_lookup_platform_id or nautobot_lookup_platform_filters for platform lookups."

- name: Run Nautobot platform lookup
  ansible.builtin.include_tasks: _run_lookup.yml
  vars:
    _id_filter: >-
      {{ ['id=' ~ nautobot_lookup_platform_id]
         if (nautobot_lookup_platform_id is defined and nautobot_lookup_platform_id | length > 0)
         else [] }}
    _explicit_filters: >-
      {{
        nautobot_lookup_platform_filters
        if (nautobot_lookup_platform_filters is defined)
        else []
      }}
    nautobot_lookup_resource: "{{ nautobot_lookup_platform_resource | default('platforms') }}"
    nautobot_lookup_filters: "{{ _id_filter + _explicit_filters }}"
    nautobot_lookup_depth_value: >-
      {{
        nautobot_lookup_depth
        if (nautobot_lookup_depth is defined)
        else (nautobot_lookup_default_depth if (nautobot_lookup_default_depth is defined) else none)
      }}
