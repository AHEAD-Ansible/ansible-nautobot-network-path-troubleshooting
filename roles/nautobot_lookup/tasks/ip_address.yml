---
# Lookup Nautobot IP address objects.
# Required vars:
#   nautobot_lookup_ip: IP address string.
# Optional vars:
#   nautobot_lookup_namespace: specific namespace override.
#   nautobot_lookup_extra_filters: list of additional "key=value" filters.
#   nautobot_lookup_depth: depth override for this lookup.

- name: Validate IP address lookup input
  ansible.builtin.assert:
    that:
      - nautobot_lookup_ip is defined
      - nautobot_lookup_ip | length > 0
    fail_msg: "nautobot_lookup_ip must be provided for IP address lookups."

- name: Run Nautobot IP address lookup
  ansible.builtin.include_tasks: _run_lookup.yml
  vars:
    _namespace: >-
      {{
        nautobot_lookup_namespace
        if (nautobot_lookup_namespace is defined)
        else (nautobot_namespace if (nautobot_namespace is defined) else none)
      }}
    _extra_filters: "{{ nautobot_lookup_extra_filters if (nautobot_lookup_extra_filters is defined) else [] }}"
    _filters: >-
      {{
        ['address=' ~ nautobot_lookup_ip]
        + (_extra_filters if (_extra_filters is iterable and not (_extra_filters is string)) else [])
        + (['namespace=' ~ _namespace] if (_namespace is not none and (_namespace | length) > 0) else [])
      }}
    nautobot_lookup_resource: "ip-addresses"
    nautobot_lookup_filters: "{{ _filters }}"
    nautobot_lookup_depth_value: >-
      {{
        nautobot_lookup_depth
        if (nautobot_lookup_depth is defined)
        else (nautobot_lookup_default_depth if (nautobot_lookup_default_depth is defined) else none)
      }}
