---
# Enriches a single hop device (dev.ip) using shared enrichment helper.

- name: Enrich hop device {{ dev.ip }}
  ansible.builtin.include_tasks: _enrich_ip.yml
  vars:
    enrich_target_ip: "{{ dev.ip }}"
    enrich_include: "{{ nautobot_enrich_include | default(omit, true) }}"
    enrich_lookup_namespace: "{{ nautobot_namespace | default(omit, true) }}"
    enrich_lookup_depth: "{{ nautobot_depth | default(omit, true) }}"

- name: Append device to tmp_devices
  ansible.builtin.set_fact:
    tmp_devices: "{{ (tmp_devices | default([])) + [ _enriched_device | default({'ip': dev.ip}) ] }}"
  delegate_to: localhost
