ip addr flush dev eth0
ip addr add 192.168.100.82/24 dev eth0
ip link set eth0 up

# ETH1: 10.100.100.100/24
ip addr flush dev eth1
ip addr add 10.50.1.100/24 dev eth1
ip link set eth1 up

# Make eth0 the primary default route
ip route replace default via 192.168.100.1 dev eth0

# Send all other RFC1918 space via eth1 (assumes next-hop 10.100.100.1 on eth1)
ip route replace 10.0.0.0/8    via 10.50.1.1 dev eth1
ip route replace 172.16.0.0/12 via 10.50.1.1 dev eth1

# install & prep
apk add --no-cache openssh
ssh-keygen -A

# create user and set password
adduser -D -s /bin/ash ansible
echo 'ansible:Labl@b1234' | chpasswd

# minimal sshd_config (Alpine-friendly; no PAM/kbd-interactive)
cat >/etc/ssh/sshd_config <<'EOF'
Port 22
Protocol 2
HostKey /etc/ssh/ssh_host_ed25519_key
HostKey /etc/ssh/ssh_host_rsa_key

PermitRootLogin no
PasswordAuthentication yes
PubkeyAuthentication yes
KbdInteractiveAuthentication no
ChallengeResponseAuthentication no
UseDNS no

Subsystem sftp /usr/lib/ssh/sftp-server
EOF

apk add --no-cache libcap traceroute
TR_BIN="$(command -v traceroute)"
setcap cap_net_raw+ep "$TR_BIN"
getcap "$TR_BIN"   # should show: /usr/bin/traceroute = cap_net_raw+ep

# restart cleanly and verify
pkill -x sshd 2>/dev/null || true
/usr/sbin/sshd -t && /usr/sbin/sshd -D -e &
ss -lntp | grep ':22' || echo "sshd not listening"
exit
