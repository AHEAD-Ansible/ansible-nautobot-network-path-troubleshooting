#!/bin/sh
set -eux

# ETH0: 10.250.250.205/24 (primary default route)
ip addr flush dev eth0 || true
ip addr add 10.250.250.205/24 dev eth0
ip link set eth0 up

# ETH1: 10.251.0.254/24
ip addr flush dev eth1 || true
ip addr add 10.251.0.205/24 dev eth1
ip link set eth1 up

# ETH2: 192.168.100.84/24
ip addr flush dev eth2 || true
ip addr add 192.168.100.84/24 dev eth2
ip link set eth2 up

# Make eth0 the primary default route
ip route replace default via 192.168.100.1 dev eth2

ip route replace 10.0.0.0/8    via 10.250.250.1 dev eth0
ip route replace 172.16.0.0/12 via 10.250.250.1 dev eth0

# No extra static routes via eth1 (only its connected /24 as requested)

# ---- Minimal HTTP server (HTTP only) ----
mkdir -p /srv/www
printf 'OK - hello from %s\n' "$(hostname)" > /srv/www/index.html

# === Start HTTP server on port 80 ===
# Prefer darkhttpd (tiny, fast). Install if missing.
if ! command -v darkhttpd >/dev/null 2>&1; then
  apk add --no-cache darkhttpd
fi
exec darkhttpd /srv/www --port 80
